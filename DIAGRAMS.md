# 📊 시스템 다이어그램 - Gamified TODO App

## 1. 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 (Users)                           │
└─────────────────────────────────────────────────────────────────┘
                    │                           │
                    │                           │
        ┌───────────▼──────────┐    ┌──────────▼──────────┐
        │   웹 브라우저         │    │   모바일 앱          │
        │   (Chrome, Safari)   │    │   (iOS, Android)    │
        └───────────┬──────────┘    └──────────┬──────────┘
                    │                           │
                    │                           │
        ┌───────────▼───────────────────────────▼──────────┐
        │              Frontend Layer                       │
        ├──────────────────────────────────────────────────┤
        │  apps/web (Next.js)    apps/native (RN + Expo)  │
        │  - App Router          - Expo Router             │
        │  - React Native Web    - Native Components      │
        │  - SSR/SSG             - Native APIs             │
        └───────────┬───────────────────────────┬──────────┘
                    │                           │
                    └───────────┬───────────────┘
                                │
                    ┌───────────▼──────────┐
                    │   Shared Packages    │
                    ├──────────────────────┤
                    │  @repo/ui            │
                    │  @repo/hooks         │
                    │  @repo/api           │
                    │  @repo/types         │
                    └───────────┬──────────┘
                                │
                    ┌───────────▼──────────┐
                    │   Backend (Supabase) │
                    ├──────────────────────┤
                    │  - PostgreSQL        │
                    │  - Auth              │
                    │  - Realtime          │
                    │  - Storage           │
                    │  - Edge Functions    │
                    └──────────────────────┘
```

---

## 2. Monorepo 구조

```
gamified-todo-app/
│
├─ apps/                          # 애플리케이션
│  ├─ web/                        # Next.js 웹 앱
│  │  ├─ src/app/                # App Router
│  │  │  ├─ (auth)/              # 인증 라우트 그룹
│  │  │  └─ (dashboard)/         # 대시보드 라우트 그룹
│  │  ├─ next.config.js          # RN Web 설정
│  │  └─ package.json
│  │
│  └─ native/                     # React Native 앱
│     ├─ app/                    # Expo Router
│     │  ├─ (auth)/              # 인증 스크린
│     │  └─ (tabs)/              # 탭 네비게이션
│     ├─ app.json                # Expo 설정
│     └─ package.json
│
├─ packages/                      # 공유 패키지
│  ├─ ui/                        # UI 컴포넌트
│  │  ├─ src/components/        # Button, Avatar, etc.
│  │  └─ src/theme/             # 테마 시스템
│  │
│  ├─ hooks/                     # React Hooks
│  │  └─ src/                   # useAuth, useTasks, etc.
│  │
│  ├─ api/                       # API 클라이언트
│  │  └─ src/                   # Supabase 함수들
│  │
│  └─ types/                     # TypeScript 타입
│     └─ src/                   # 공통 타입 정의
│
├─ turbo.json                    # Turborepo 설정
├─ package.json                  # Root package.json
└─ pnpm-workspace.yaml           # PNPM Workspace
```

---

## 3. 데이터 플로우 - 태스크 완료

```
┌─────────────────────────────────────────────────────────────────┐
│ 1. User Action                                                   │
│    사용자가 "Complete Task" 버튼 클릭                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 2. Optimistic Update (즉시 UI 업데이트)                         │
│    - React Query 캐시 즉시 수정                                 │
│    - task.isCompleted = true                                    │
│    - 사용자는 즉각적인 피드백 받음                              │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 3. API 요청                                                      │
│    POST /rpc/complete_task                                      │
│    { taskId: "xxx" }                                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 4. Supabase Function 실행                                       │
│    BEGIN TRANSACTION;                                           │
│    ├─ UPDATE tasks SET is_completed = true                     │
│    ├─ SELECT difficulty FROM tasks                             │
│    ├─ CALCULATE xp_reward (difficulty * multiplier)            │
│    ├─ UPDATE characters SET xp = xp + xp_reward               │
│    ├─ CHECK IF level_up (xp >= xp_needed)                     │
│    ├─ IF level_up: UPDATE level, award bonus gold             │
│    └─ CALCULATE gold_reward (xp_reward / 2)                   │
│    COMMIT;                                                      │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 5. Response 수신                                                 │
│    {                                                            │
│      task: { id, isCompleted: true },                          │
│      character: { xp: 150, level: 2, gold: 75 }               │
│    }                                                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 6. React Query Cache 무효화                                     │
│    queryClient.invalidateQueries(['tasks'])                    │
│    queryClient.invalidateQueries(['character'])                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 7. UI 자동 업데이트                                              │
│    - 새로운 XP, Level 표시                                      │
│    - 레벨업 애니메이션 (if level_up)                           │
│    - 골드 증가 표시                                             │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 실시간 동기화 플로우

```
┌──────────────┐                    ┌──────────────┐
│  Device A    │                    │  Device B    │
│  (Web)       │                    │  (Mobile)    │
└──────┬───────┘                    └──────┬───────┘
       │                                   │
       │ 1. Task 완료                      │
       ├──────────────┐                    │
       │              │                    │
       ▼              ▼                    │
┌─────────────────────────────────┐       │
│     Supabase PostgreSQL         │       │
│  UPDATE tasks                   │       │
│  SET is_completed = true        │       │
└─────────────┬───────────────────┘       │
              │                            │
              │ 2. Trigger 발동            │
              ▼                            │
┌─────────────────────────────────┐       │
│   Supabase Realtime             │       │
│   WebSocket Broadcast           │       │
└─────────────┬───────────────────┘       │
              │                            │
              │ 3. Subscription 수신       │
              └────────────────────────────▶
                                           │
                                           ▼
                              ┌────────────────────────┐
                              │  React Query           │
                              │  Cache Invalidation    │
                              └────────────┬───────────┘
                                           │
                                           ▼
                              ┌────────────────────────┐
                              │  UI 자동 업데이트      │
                              │  - Task 상태 변경      │
                              │  - XP 증가 표시        │
                              └────────────────────────┘
```

---

## 5. 인증 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│ 1. 사용자 로그인 시도                                            │
│    Email: user@example.com                                      │
│    Password: ********                                           │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 2. useAuth Hook                                                 │
│    const { signIn } = useAuth()                                │
│    await signIn(email, password)                               │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 3. Supabase Auth API                                            │
│    POST /auth/v1/token?grant_type=password                     │
│    { email, password }                                          │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 4. JWT 토큰 발급                                                 │
│    {                                                            │
│      access_token: "eyJxxx...",                                │
│      refresh_token: "xxx...",                                  │
│      user: { id, email }                                       │
│    }                                                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 5. 토큰 저장                                                     │
│    Web: HttpOnly Cookie                                        │
│    Mobile: Secure Storage                                      │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 6. React Query Cache 업데이트                                   │
│    queryClient.setQueryData(['auth', 'user'], user)           │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│ 7. 라우팅                                                        │
│    Web: router.push('/dashboard')                              │
│    Mobile: router.replace('/(tabs)')                           │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. 컴포넌트 계층 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         App Root                                 │
│                    (QueryClientProvider)                         │
└────────────────────────┬────────────────────────────────────────┘
                         │
         ┌───────────────┴───────────────┐
         │                               │
         ▼                               ▼
┌─────────────────┐           ┌─────────────────┐
│  Auth Layout    │           │ Dashboard Layout│
│  (auth group)   │           │ (dashboard)     │
└────────┬────────┘           └────────┬────────┘
         │                              │
    ┌────┴────┐                    ┌────┴────────────────┐
    │         │                    │         │           │
    ▼         ▼                    ▼         ▼           ▼
┌──────┐ ┌──────┐          ┌──────────┐ ┌──────┐ ┌──────────┐
│Login │ │Signup│          │Dashboard │ │Tasks │ │Character │
└──────┘ └──────┘          └────┬─────┘ └──┬───┘ └────┬─────┘
                                 │          │          │
                    ┌────────────┴──────────┴──────────┴────┐
                    │                                        │
                    ▼                                        ▼
            ┌───────────────┐                      ┌─────────────┐
            │ Shared UI     │                      │ Shared Hooks│
            │ (@repo/ui)    │                      │ (@repo/hooks)│
            ├───────────────┤                      ├─────────────┤
            │ - Button      │                      │ - useAuth   │
            │ - Avatar      │                      │ - useTasks  │
            │ - ProgressBar │                      │ - useChar   │
            └───────────────┘                      └─────────────┘
```

---

## 7. 데이터베이스 ERD

```
┌─────────────────────┐
│      users          │
│  (Supabase Auth)    │
├─────────────────────┤
│ id (PK)             │◄─────────┐
│ email               │          │
│ created_at          │          │
└─────────────────────┘          │
                                 │
                                 │ user_id (FK)
                                 │
┌─────────────────────┐          │
│      tasks          │          │
├─────────────────────┤          │
│ id (PK)             │          │
│ user_id (FK)        │──────────┤
│ title               │          │
│ description         │          │
│ type                │          │
│ difficulty          │          │
│ is_completed        │          │
│ completed_at        │          │
│ created_at          │          │
└─────────────────────┘          │
                                 │
┌─────────────────────┐          │
│    characters       │          │
├─────────────────────┤          │
│ id (PK)             │          │
│ user_id (FK)        │──────────┤
│ level               │          │
│ xp                  │          │
│ hp                  │          │
│ gold                │          │
│ avatar_config       │          │
│ theme               │          │
│ created_at          │          │
│ updated_at          │          │
└─────────────────────┘          │
                                 │
┌─────────────────────┐          │
│      rewards        │          │
├─────────────────────┤          │
│ id (PK)             │          │
│ user_id (FK)        │──────────┤
│ name                │          │
│ description         │          │
│ price               │          │
│ type                │          │
│ icon                │          │
│ is_custom           │          │
│ created_at          │          │
└─────────────────────┘          │
                                 │
┌─────────────────────┐          │
│     inventory       │          │
├─────────────────────┤          │
│ id (PK)             │          │
│ user_id (FK)        │──────────┘
│ reward_id (FK)      │
│ quantity            │
│ is_equipped         │
│ acquired_at         │
└─────────────────────┘
```

---

## 8. React Query 캐싱 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                    React Query Cache                             │
└─────────────────────────────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
        ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ ['auth',     │  │ ['tasks']    │  │ ['character']│
│  'user']     │  │              │  │              │
├──────────────┤  ├──────────────┤  ├──────────────┤
│ staleTime:   │  │ staleTime:   │  │ staleTime:   │
│ Infinity     │  │ 5 min        │  │ 5 min        │
│              │  │              │  │              │
│ cacheTime:   │  │ cacheTime:   │  │ cacheTime:   │
│ 24 hours     │  │ 10 min       │  │ 10 min       │
└──────────────┘  └──────────────┘  └──────────────┘
       │                 │                 │
       │                 │                 │
       ▼                 ▼                 ▼
┌──────────────────────────────────────────────────┐
│            Invalidation Triggers                  │
├──────────────────────────────────────────────────┤
│ - signOut() → invalidate ['auth', 'user']       │
│ - completeTask() → invalidate ['tasks']         │
│ - completeTask() → invalidate ['character']     │
│ - createTask() → invalidate ['tasks']           │
│ - updateCharacter() → invalidate ['character']  │
└──────────────────────────────────────────────────┘
```

---

## 9. 배포 파이프라인

```
┌─────────────────────────────────────────────────────────────────┐
│                      Developer                                   │
│                   git push origin main                           │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                      GitHub                                      │
│                   Repository                                     │
└────────────────────────┬────────────────────────────────────────┘
                         │
         ┌───────────────┴───────────────┐
         │                               │
         ▼                               ▼
┌─────────────────┐           ┌─────────────────┐
│  Vercel         │           │  EAS Build      │
│  (Web Deploy)   │           │  (Mobile Build) │
└────────┬────────┘           └────────┬────────┘
         │                              │
         │ 1. Install deps              │ 1. Install deps
         │ 2. Build packages            │ 2. Build packages
         │ 3. Build web app             │ 3. Build native app
         │ 4. Deploy to Edge            │ 4. Submit to stores
         │                              │
         ▼                              ▼
┌─────────────────┐           ┌─────────────────┐
│  Production     │           │  App Stores     │
│  (Web)          │           │  (iOS/Android)  │
└─────────────────┘           └─────────────────┘
```

---

## 10. 성능 최적화 전략

```
┌─────────────────────────────────────────────────────────────────┐
│                    Performance Optimization                      │
└─────────────────────────────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┬────────────────┐
        │                │                │                │
        ▼                ▼                ▼                ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ React Query  │  │ Code         │  │ Image        │  │ Virtualization│
│ Caching      │  │ Splitting    │  │ Optimization │  │              │
├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤
│ - staleTime  │  │ - Dynamic    │  │ - Next.js    │  │ - FlatList   │
│ - cacheTime  │  │   import()   │  │   Image      │  │ - 화면에     │
│ - Prefetch   │  │ - Route-     │  │ - WebP       │  │   보이는     │
│              │  │   based      │  │ - Lazy Load  │  │   항목만     │
│ 결과:        │  │              │  │              │  │              │
│ 90% 요청     │  │ 결과:        │  │ 결과:        │  │ 결과:        │
│ 감소         │  │ 40% 번들     │  │ 60% 빠른     │  │ 1000개       │
│              │  │ 사이즈 감소  │  │ 로딩         │  │ 항목 부드럽게│
└──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘
```

---

이 다이어그램들을 면접에서 화이트보드에 그리면서 설명하면
아키텍처 이해도를 효과적으로 보여줄 수 있습니다! 🎯
